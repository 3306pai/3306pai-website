"use strict";(self.webpackChunkdatabend_official_front=self.webpackChunkdatabend_official_front||[]).push([[1477],{10:function(e){e.exports=JSON.parse('{"blogPosts":[{"id":"Databend architecture","metadata":{"permalink":"/blog/databend-architecture","source":"@site/blog/databend-architecture.md","title":"Databend architecture","description":"Databend \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u3001\u5b8c\u5168\u9762\u5411\u4e91\u67b6\u6784\u7684\u65b0\u5f0f\u6570\u4ed3\uff0c\u5b83\u63d0\u4f9b\u5feb\u901f\u7684\u5f39\u6027\u6269\u5c55\u80fd\u529b\uff0c\u5e76\u7ed3\u5408\u4e91\u7684\u5f39\u6027\u3001\u7b80\u5355\u6027\u548c\u4f4e\u6210\u672c\uff0c\u4f7f Data Cloud \u6784\u5efa\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002","date":"2021-11-22T01:45:31.990Z","formattedDate":"November 22, 2021","tags":[],"readingTime":6.695,"truncated":false,"authors":[],"nextItem":{"title":"\u6280\u672f\u5206\u4eab | MySQL\u8fdb\u7a0b\u53f7\u3001\u8fde\u63a5ID\u3001\u67e5\u8be2ID\u3001InnoDB\u7ebf\u7a0b\u4e0e\u7cfb\u7edf\u7ebf\u7a0b\u5982\u4f55\u5bf9\u5e94","permalink":"/blog/howto-find-out-os-mysql-innodb-thread"}},"content":"Databend \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u3001\u5b8c\u5168\u9762\u5411\u4e91\u67b6\u6784\u7684\u65b0\u5f0f\u6570\u4ed3\uff0c\u5b83\u63d0\u4f9b\u5feb\u901f\u7684\u5f39\u6027\u6269\u5c55\u80fd\u529b\uff0c\u5e76\u7ed3\u5408\u4e91\u7684\u5f39\u6027\u3001\u7b80\u5355\u6027\u548c\u4f4e\u6210\u672c\uff0c\u4f7f Data Cloud \u6784\u5efa\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002\\nDatabend \u628a\u6570\u636e\u5b58\u50a8\u5728\u50cf AWS S3 \uff0cAzure Blob \u8fd9\u4e9b\u4e91\u4e0a\u7684\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4f7f\u4e0d\u540c\u7684\u8ba1\u7b97\u8282\u70b9\u6302\u8f7d\u540c\u4e00\u4efd\u6570\u636e\uff0c\u4ece\u800c\u505a\u5230\u8f83\u9ad8\u7684\u5f39\u6027\uff0c\u5b9e\u73b0\u5bf9\u8d44\u6e90\u7684\u7cbe\u7ec6\u5316\u63a7\u5236\u3002\\nDatabend \u5728\u8bbe\u8ba1\u4e0a\u4e13\u6ce8\u4ee5\u4e0b\u80fd\u529b\uff1a\\n\\n* \u5f39\u6027 \u5728 Databend \u4e2d\uff0c\u5b58\u50a8\u548c\u8ba1\u7b97\u8d44\u6e90\u53ef\u4ee5\u6309\u9700\u3001\u6309\u91cf\u5f39\u6027\u6269\u5c55\u3002\\n* \u5b89\u5168 Databend \u4e2d\u6570\u636e\u6587\u4ef6\u548c\u7f51\u7edc\u4f20\u8f93\u90fd\u662f\u7aef\u5230\u7aef\u52a0\u5bc6\uff0c\u5e76\u5728 SQL \u7ea7\u522b\u63d0\u4f9b\u57fa\u4e8e\u89d2\u8272\u7684\u6743\u9650\u63a7\u5236\u3002\\n* \u6613\u7528 Databend \u517c\u5bb9 ANSI SQL\uff0c\u5e76\u53ef\u4ee5\u4f7f\u7528 MySQL \u548c ClickHouse \u5ba2\u6237\u7aef\u63a5\u5165\uff0c\u51e0\u4e4e\u65e0\u5b66\u4e60\u6210\u672c\u3002\\n* \u6210\u672c Databend \u5904\u7406\u67e5\u8be2\u975e\u5e38\u9ad8\u6548\uff0c\u7528\u6237\u53ea\u9700\u8981\u4e3a\u4f7f\u7528\u7684\u8d44\u6e90\u4ed8\u8d39\u3002\\n\\n![](https://datafuse-1255499614.cos.ap-beijing.myqcloud.com/architecture_v1.png)\\n\\n\u4e0a\u56fe\u662f Databend \u7684\u6574\u4f53\u67b6\u6784\u56fe\uff0c\u6574\u4e2a\u7cfb\u7edf\u4e3b\u8981\u7531\u4e09\u5927\u90e8\u5206\u7ec4\u6210\uff1aMeta service layer\u3001Compute Layer \u548c Storage Layer\u3002\\n## 1\u3001Meta Service Layer\\n\\n* Meta Service \u662f\u4e00\u4e2a\u591a\u79df\u6237\u3001\u9ad8\u53ef\u7528\u7684\u5206\u5e03\u5f0f key-value \u5b58\u50a8\u670d\u52a1\uff0c\u5177\u5907\u4e8b\u52a1\u80fd\u529b\uff0c\u4e3b\u8981\u7528\u4e8e\u5b58\u50a8\uff1a\\n* Metadata : \u8868\u7684\u5143\u4fe1\u606f\u3001\u7d22\u5f15\u4fe1\u606f\u3001\u96c6\u7fa4\u4fe1\u606f\u3001\u4e8b\u52a1\u4fe1\u606f\u7b49\u3002\\n* Administration\uff1a\u7528\u6237\u7cfb\u7edf\u3001\u7528\u6237\u6743\u9650\u7b49\u4fe1\u606f\u3002\\n* Security \uff1a\u7528\u6237\u767b\u5f55\u8ba4\u8bc1\u3001\u6570\u636e\u52a0\u5bc6\u7b49\u3002\\n\\n## 2\u3001Compute Layer\\n\\n\u8ba1\u7b97\u5c42\u7531\u591a\u4e2a\u96c6\u7fa4\uff08cluster\uff09\u7ec4\u6210\uff0c\u4e0d\u540c\u96c6\u7fa4\u53ef\u4ee5\u627f\u62c5\u4e0d\u540c\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u53c8\u6709\u591a\u4e2a\u8ba1\u7b97\u8282\u70b9\uff08node\uff09\u7ec4\u6210\uff0c\u4f60\u53ef\u4ee5\u8f7b\u677e\u7684\u6dfb\u52a0\u3001\u5220\u9664\u8282\u70b9\u6216\u96c6\u7fa4\uff0c\u505a\u5230\u8d44\u6e90\u7684\u6309\u9700\u3001\u6309\u91cf\u7ba1\u7406\u3002\\n\u8ba1\u7b97\u8282\u70b9\u662f\u8ba1\u7b97\u5c42\u7684\u6700\u5c0f\u6784\u6210\u5355\u5143\uff0c\u5176\u4e2d\u6bcf\u4e2a\u8ba1\u7b97\u8282\u70b9\u5305\u542b\u4ee5\u4e0b\u51e0\u4e2a\u7ec4\u4ef6\uff1a\\n\u6267\u884c\u8ba1\u5212 \uff08Planner\uff09\\n\u6839\u636e\u7528\u6237\u8f93\u5165\u7684 SQL \u751f\u6210\u6267\u884c\u8ba1\u5212\uff0c\u5b83\u53ea\u662f\u4e2a\u903b\u8f91\u8868\u8fbe\uff0c\u5e76\u4e0d\u80fd\u771f\u6b63\u7684\u6267\u884c\uff0c\u800c\u662f\u7528\u4e8e\u6307\u5bfc\u6574\u4e2a\u8ba1\u7b97\u6d41\u6c34\u7ebf\uff08Pipeline\uff09\u7684\u7f16\u6392\u4e0e\u751f\u6210\u3002\\n\u6bd4\u5982\u8bed\u53e5\\n\\n\\tSELECT number + 1 FROM numbers_mt(10) WHERE number > 8 LIMIT 2 \\n\\n\u6267\u884c\u8ba1\u5212\uff1a\\n\\n\\tdatabend :) EXPLAIN SELECT number + 1 FROM numbers_mt(10) WHERE number > 8 LIMIT 2\\n\\t\u250c\u2500explain\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n\\t\u2502 Limit: 2                                                                                                                \u2502\\n\\t\u2502   Projection: (number + 1):UInt64                                                                                       \u2502\\n\\t\u2502     Expression: (number + 1):UInt64 (Before Projection)                                                                 \u2502\\n\\t\u2502       Filter: (number > 8)                                                                                              \u2502\\n\\t\u2502         ReadDataSource: scan partitions: [1], scan schema: [number:UInt64], statistics: [read_rows: 10, read_bytes: 80] \u2502\\n\\t\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n\\n\u8fd9\u4e2a\u6267\u884c\u8ba1\u5212\u81ea\u4e0b\u800c\u4e0a\u5206\u522b\u662f \uff1a\\n\\n* ReadDataSource\uff1a\u8868\u793a\u4ece\u54ea\u4e9b\u6587\u4ef6\u91cc\u8bfb\u53d6\u6570\u636e\\n\\n* Filter: \u8868\u793a\u8981\u505a (number > 8) \u8868\u8fbe\u5f0f\u8fc7\u6ee4\\n\\n* Expression: \u8868\u793a\u8981\u505a (number + 1) \u8868\u8fbe\u5f0f\u8fd0\u7b97\\n\\n* Projection: \u8868\u793a\u67e5\u8be2\u5217\u662f\u54ea\u4e9b\\n\\n* Limit: \u8868\u793a\u53d6\u524d 2 \u6761\u6570\u636e\\n\\n### \u4f18\u5316\u5668 \uff08Optimizer\uff09\\n\\n\u5bf9\u6267\u884c\u8ba1\u5212\u505a\u4e00\u4e9b\u57fa\u4e8e\u89c4\u5219\u7684\u4f18\u5316\uff08A Rule Based Optimizer\uff09, \u6bd4\u5982\u505a\u4e00\u4e9b\u8c13\u8bcd\u4e0b\u63a8\u6216\u662f\u53bb\u6389\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u5217\u7b49\uff0c\u4ee5\u4f7f\u6574\u4e2a\u6267\u884c\u8ba1\u5212\u66f4\u4f18\u3002\\n\\n### \u5904\u7406\u5668 \uff08Processors\uff09\\n\\n\u5904\u7406\u5668\uff08Processor\uff09\u662f\u6267\u884c\u8ba1\u7b97\u903b\u8f91\u7684\u6838\u5fc3\u7ec4\u4ef6\u3002\u6839\u636e\u6267\u884c\u8ba1\u5212\uff0c\u5904\u7406\u5668\u4eec\u88ab\u7f16\u6392\u6210\u4e00\u4e2a\u6d41\u6c34\u7ebf\uff08Pipeline\uff09\uff0c\u7528\u4e8e\u6267\u884c\u8ba1\u7b97\u4efb\u52a1\u3002\\n\u6574\u4e2a Pipeline \u662f\u4e00\u4e2a\u6709\u5411\u65e0\u73af\u56fe\uff0c\u6bcf\u4e2a\u70b9\u662f\u4e00\u4e2a\u5904\u7406\u5668\uff0c\u6bcf\u6761\u8fb9\u7531\u5904\u7406\u5668\u7684 InPort \u548c OutPort \u76f8\u8fde\u6784\u6210\uff0c\u6570\u636e\u5230\u8fbe\u4e0d\u540c\u7684\u5904\u7406\u5668\u8fdb\u884c\u8ba1\u7b97\u540e\uff0c\u901a\u8fc7\u8fb9\u6d41\u5411\u4e0b\u4e00\u4e2a\u5904\u7406\u5668\uff0c\u591a\u4e2a\u5904\u7406\u5668\u53ef\u4ee5\u5e76\u884c\u8ba1\u7b97\uff0c\u5728\u96c6\u7fa4\u6a21\u5f0f\u4e0b\u8fd8\u53ef\u4ee5\u8de8\u8282\u70b9\u5206\u5e03\u5f0f\u6267\u884c\uff0c\u8fd9\u662f Datafuse \u9ad8\u6027\u80fd\u7684\u4e00\u4e2a\u91cd\u8981\u8bbe\u8ba1\u3002\\n\\n\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 EXPLAIN PIPELINE \u6765\u67e5\u770b\uff1a\\n\\n\\tdatabend :) EXPLAIN PIPELINE SELECT number + 1 FROM numbers_mt(10000) WHERE number > 8 LIMIT 2\\n\\t\u250c\u2500explain\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n\\t\u2502 LimitTransform \xd7 1 processor                                                                              \u2502\\n\\t\u2502   Merge (ProjectionTransform \xd7 16 processors) to (LimitTransform \xd7 1)     \u2502\\n\\t\u2502     ProjectionTransform \xd7 16 processors                                                             \u2502\\n\\t\u2502       ExpressionTransform \xd7 16 processors                                                         \u2502\\n\\t\u2502         FilterTransform \xd7 16 processors                                                                 \u2502\\n\\t\u2502           SourceTransform \xd7 16 processors                                                           \u2502\\n\\t\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n\\n\u540c\u6837\uff0c\u7406\u89e3\u8fd9\u4e2a Pipeline \u6211\u4eec\u81ea\u4e0b\u800c\u4e0a\u6765\u770b\uff1a\\n\\n* SourceTransform\uff1a\u8bfb\u53d6\u6570\u636e\u6587\u4ef6\uff0c16 \u4e2a\u7269\u7406 CPU \u5e76\u884c\u5904\u7406\\n* ilterTransform\uff1a\u5bf9\u6570\u636e\u8fdb\u884c (number >  8) \u8868\u8fbe\u5f0f\u8fc7\u6ee4\uff0c16 \u4e2a\u7269\u7406 CPU \u5e76\u884c\u5904\u7406 \\n* pressionTransform\uff1a\u5bf9\u6570\u636e\u8fdb\u884c (number + 1) \u8868\u8fbe\u5f0f\u6267\u884c\uff0c16 \u4e2a\u7269\u7406 CPU \u5e76\u884c\u5904\u7406 \\n* ojectionTransform\uff1a\u5bf9\u6570\u636e\u5904\u7406\u751f\u6210\u6700\u7ec8\u5217 \\n* LimitTransform\uff1a\u5bf9\u6570\u636e\u8fdb\u884c Limit 2 \u5904\u7406\uff0cPipeline \u8fdb\u884c\u6298\u53e0\uff0c\u7531\u4e00\u4e2a\u7269\u7406 CPU \u6765\u6267\u884c \\n* Databend \u901a\u8fc7 Pipeline \u5e76\u884c\u6a21\u578b\uff0c\u5e76\u7ed3\u5408\u5411\u91cf\u8ba1\u7b97\u6700\u5927\u9650\u5ea6\u7684\u53bb\u538b\u69a8 CPU \u8d44\u6e90\uff0c\u4ee5\u52a0\u901f\u8ba1\u7b97\u3002\\n\\n### \u7f13\u5b58 ( Cache )\\n\\n\u8ba1\u7b97\u8282\u70b9\u4f7f\u7528\u672c\u5730 SSD \u7f13\u5b58\u6570\u636e\u548c\u7d22\u5f15\uff0c\u4ee5\u63d0\u9ad8\u6570\u636e\u4eb2\u548c\u6027\u6765\u52a0\u901f\u8ba1\u7b97\u3002\\n\u7f13\u5b58\u7684\u9884\u70ed\u65b9\u5f0f\u6709\uff1a\\nLOAD_ON_DEMAND - \u6309\u9700\u52a0\u8f7d\u7d22\u5f15\u6216\u6570\u636e\u5757\uff08\u9ed8\u8ba4\uff09\u3002\\nLOAD_INDEX - \u53ea\u52a0\u8f7d\u7d22\u5f15\u3002\\nLOAD_ALL - \u52a0\u8f7d\u5168\u90e8\u7684\u6570\u636e\u548c\u7d22\u5f15\uff0c\u5bf9\u4e8e\u8f83\u5c0f\u7684\u8868\u53ef\u4ee5\u91c7\u53d6\u8fd9\u79cd\u6a21\u5f0f\u3002\\n\\n## 3. Storage Layer\\n\\nDatabend \u4f7f\u7528 Parquet \u5217\u5f0f\u5b58\u50a8\u683c\u5f0f\u6765\u50a8\u5b58\u6570\u636e\uff0c\u4e3a\u4e86\u52a0\u5feb\u67e5\u627e\uff08Partition Pruning\uff09\uff0cDatabend  \u4e3a\u6bcf\u4e2a Parquet \u63d0\u4f9b\u4e86\u81ea\u5df1\u7684\u7d22\u5f15\uff08\u6839\u636e Primary Key \u751f\u6210\uff09\uff1a\\nmin_max.idx Parquet \u6587\u4ef6 minimum \u548c maximum \u503c\\nsparse.idx \u4ee5 N \u6761\u8bb0\u5f55\u4e3a\u9897\u7c92\u5ea6\u7684\u7a00\u758f\u7d22\u5f15\\n\u901a\u8fc7\u8fd9\u4e9b\u7d22\u5f15\uff0c \u6211\u4eec\u53ef\u4ee5\u51cf\u5c11\u6570\u636e\u7684\u4ea4\u4e92\uff0c\u5e76\u4f7f\u8ba1\u7b97\u91cf\u5927\u5927\u51cf\u5c11\u3002\\n\u5047\u8bbe\u6709\u4e24\u4e2aParquet \u6587\u4ef6\uff1af1, f2\uff0cf1 \u7684 min_max.idx: [3, 5] \uff1bf2 \u7684 min_max.idx: [4, 6] \u3002\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e3a\uff1awhere x < 4 \uff0c \u6211\u4eec\u53ea\u9700\u8981 f1 \u6587\u4ef6\u5c31\u53ef\u4ee5\uff0c\u518d\u6839\u636e sparse.idx \u7d22\u5f15\u5b9a\u4f4d\u5230 f1 \u6587\u4ef6\u4e2d\u7684\u67d0\u4e2a\u6570\u636e\u9875\u3002\\n\\n## \u9879\u76ee\u5730\u5740\\n\\n\u4ee3\u7801\u5730\u5740\uff1a\\nhttps://github.com/datafuselabs/databend\\n\\n\u9879\u76ee\u5b98\u7f51\uff1a\\nhttps://datafuse.rs\\n\\n\u60f3\u4e86\u89e3\u6211\u4eec\u66f4\u591a\u53ef\u4ee5\u5173\u6ce8\u516c\u4f17\u53f7\uff1a Databend ."},{"id":"\u6280\u672f\u5206\u4eab | MySQL\u8fdb\u7a0b\u53f7\u3001\u8fde\u63a5ID\u3001\u67e5\u8be2ID\u3001InnoDB\u7ebf\u7a0b\u4e0e\u7cfb\u7edf\u7ebf\u7a0b\u5982\u4f55\u5bf9\u5e94","metadata":{"permalink":"/blog/howto-find-out-os-mysql-innodb-thread","source":"@site/blog/howto-find-out-os-mysql-innodb-thread.md","title":"\u6280\u672f\u5206\u4eab | MySQL\u8fdb\u7a0b\u53f7\u3001\u8fde\u63a5ID\u3001\u67e5\u8be2ID\u3001InnoDB\u7ebf\u7a0b\u4e0e\u7cfb\u7edf\u7ebf\u7a0b\u5982\u4f55\u5bf9\u5e94","description":"---","date":"2021-11-22T01:45:31.990Z","formattedDate":"November 22, 2021","tags":[],"readingTime":7.98,"truncated":false,"authors":[],"prevItem":{"title":"Databend architecture","permalink":"/blog/databend-architecture"},"nextItem":{"title":"\u6570\u636e\u5e93\u7d22\u5f15\u603b\u7ed3\uff1a\u6a21\u578b\u6570\u7a7a\u8fd0\u6700\u5feb","permalink":"/blog/2021/11/22/songhua"}},"content":"---\\n\\ntitle: \u6280\u672f\u5206\u4eab | MySQL\u8fdb\u7a0b\u53f7\u3001\u8fde\u63a5ID\u3001\u67e5\u8be2ID\u3001InnoDB\u7ebf\u7a0b\u4e0e\u7cfb\u7edf\u7ebf\u7a0b\u5982\u4f55\u5bf9\u5e94\\n\\nauthor: \u53f6\u91d1\u8363\\n\\nkeywords: [Linux, MySQL, InnoDB]\\n\\n---\\n\\n## \u5bfc\u8bfb\\n> \u4e00\u6587\u5feb\u901f\u638c\u63e1 MySQL\u8fdb\u7a0b\u53f7\u3001\u8fde\u63a5ID\u3001\u67e5\u8be2ID\u3001InnoDB\u7ebf\u7a0b\u4e0e\u7cfb\u7edf\u7ebf\u7a0b\u7684\u5bf9\u5e94\u5173\u7cfb\u3002\\n\\n\u6709\u65f6\u5019\uff0c\u6000\u7591\u67d0\u4e2aMySQL\u5185\u5b58\u67e5\u8be2\u5bfc\u81f4CPU\u6216\u78c1\u76d8I/O\u6d88\u8017\u7279\u522b\u9ad8\uff0c\u4f46\u53c8\u4e0d\u786e\u5b9a\u5177\u4f53\u662f\u54ea\u4e2aSQL\u5f15\u8d77\u7684\u3002\\n\\n\u6216\u8005\u5f53InnoDB\u5f15\u64ce\u5185\u90e8\u6709semaphore wait\u65f6\uff0c\u60f3\u77e5\u9053\u5177\u4f53\u662f\u54ea\u4e2a\u7ebf\u7a0b/\u67e5\u8be2\u5f15\u8d77\u7684\u3002\u591a\u8bf4\u4e00\u4e0b\uff0c\u5f53\u6709semaphore wait\u4e8b\u4ef6\u8d85\u8fc7600\u79d2\u7684\u8bdd\uff0cInnoDB\u4f1a\u53d1\u51facrash\u4fe1\u53f7\uff1a\\n```\\nInnoDB: ###### Diagnostic info printed to the standard error stream\\n2020-12-13T09:41:33.810011Z 0 [ERROR] [FATAL] InnoDB: Semaphore wait has lasted > 600 seconds. We intentionally crash the server because it appears to be hung.\\n2020-12-13 10:41:33 0x7f3d92a4e700 InnoDB: Assertion failure in thread 139902430013184 in file ut0ut.cc line 917\\nInnoDB: We intentionally generate a memory trap.\\nInnoDB: Submit a detailed bug report to http://bugs.mysql.com.\\nInnoDB: If you get repeated assertion failures or crashes, even\\nInnoDB: immediately after the mysqld startup, there may be\\nInnoDB: corruption in the InnoDB tablespace. Please refer to\\nInnoDB: http://dev.mysql.com/doc/refman/8.0/en/forcing-innodb-recovery.html\\nInnoDB: about forcing recovery.\\n09:41:33 UTC - mysqld got signal 6 ;\\n```\\n\u56e0\u6b64\u4e5f\u8981\u76d1\u63a7InnoDB\u7684semaphore wait\u72b6\u6001\uff0c\u4e00\u65e6\u8d85\u8fc7\u9608\u503c\uff0c\u5c31\u8981\u5c3d\u5feb\u62a5\u8b66\u5e76\u5206\u6790\u51fa\u95ee\u9898\u539f\u56e0\uff0c\u53ca\u65f6\u6740\u6389\u6216\u505c\u6b62\u5f15\u8d77\u7b49\u5f85\u7684\u67e5\u8be2\u8bf7\u6c42\u3002\\n\\n\u4e0d\u8fc7\u672c\u6587\u60f3\u8ba8\u8bba\u7684\u662f\uff0cMySQL\u7684\u8fdb\u7a0bID\u3001\u5185\u90e8\u67e5\u8be2ID\u3001\u5185\u90e8\u7ebf\u7a0bID\uff0c\u548c\u64cd\u4f5c\u7cfb\u7edf\u5c42\u7684\u8fdb\u7a0bID\u3001\u7ebf\u7a0b\u5982\u4f55\u5bf9\u5e94\u8d77\u6765\u3002\\n\\n## 1\u3001\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0bID\\nMySQL\u662f\u4e00\u4e2a\u5355\u8fdb\u7a0b\u591a\u7ebf\u7a0b\u7684\u670d\u52a1\u7a0b\u5e8f\uff0c\u7528 `ps -ef|grep mysqld` \u5c31\u80fd\u770b\u5230\u5176\u7cfb\u7edf\u8fdb\u7a0bID\u4e86\u3002\u53e6\u5916\uff0c\u5f53 `my.cnf` \u914d\u7f6e\u6587\u4ef6\u4e2d\u589e\u52a0\u4e00\u884c `innodb_status_file = 1` \u65f6\uff0c\u4e5f\u4f1a\u751f\u6210\u5e26\u6709\u7cfb\u7edf\u8fdb\u7a0bID\u7684innodb status \u6587\u4ef6\\n```\\n[root@yejr.run]# ps -ef | grep mysqld\\nmysql    38801     1  0 Jun13 ?        00:03:30 /usr/local/GreatSQL-8.0.22/bin/mysqld --defaults-file=/mysql/data06/my.cnf\\n\\n[root@yejr.run]# ls -la innodb_status.38801\\n-rw-r----- 1 mysql mysql 4906 Jun 14 14:26 innodb_status.38801\\n```\\n\u6587\u4ef6 `innodb_status.pid` \u7684\u4f5c\u7528\u662f\u6bcf\u969415\u79d2\u5de6\u53f3\u8f93\u51fainnodb\u5f15\u64ce\u5404\u79cd\u72b6\u6001\u4fe1\u606f\uff0c\u548c\u6267\u884c `SHOW ENGINE INNODB STATUS` \u7684\u4f5c\u7528\u76f8\u540c\u3002 \u4e8c\u8005\u7684\u533a\u522b\u5728\u4e8e\uff0c\u524d\u8005\uff08\u6587\u4ef6\u8f93\u51fa\u65b9\u5f0f\uff09\u7684\u8f93\u51fa\u5185\u5bb9\u957f\u5ea6\u4e0d\u53d7\u9650\u5236\uff0c\u800c\u540e\u8005\uff08\u547d\u4ee4\u884c\u8f93\u51fa\uff09\u5219\u6700\u591a\u53ea\u663e\u793a1MB\u5185\u5bb9\uff0c\u66f4\u591a\u7684\u4f1a\u88ab\u622a\u65ad\u3002\u6240\u4ee5\u52a1\u5fc5\u8bbe\u7f6e `innodb_status_file = 1` \u9009\u9879\u3002\\n```\\nStandard Monitor output is limited to 1MB when produced using the SHOW ENGINE INNODB STATUS statement. This limit does not apply to output written to server standard error output (stderr).\\n```\\n\\n## 2\u3001\u7cfb\u7edf\u7ebf\u7a0b\u548cMySQL\u8fde\u63a5ID\u3001\u67e5\u8be2ID\u7b49\u7684\u5173\u7cfb\\n\u4eceMySQL 5.7\u5f00\u59cb\uff0c`performance_schema.threads` \u8868\u589e\u52a0 `THREAD_OS_ID` \u5217\uff0c\u7528\u4e8e\u8bb0\u5f55MySQL\u5185\u90e8\u7ebf\u7a0b\u5bf9\u5e94\u7684\u7cfb\u7edf\u7ebf\u7a0bID\u3002\\n\\n\u521b\u5efa\u4e00\u4e2a\u65b0\u8fde\u63a5\uff0c\u5e76\u6267\u884c\u4e0b\u9762\u7684SQL\uff1a\\n```\\n[root@yejr.run]# mysql -S./mysql.sock -uroot -p mymgr\\n...\\n# \u67e5\u5230MySQL\u7684\u8fde\u63a5ID\u662f25\uff08PROCESSLIST_ID = 25\uff09\\n[root@yejr.run] [none]> show processlist;\\n+----+------+-----------+-------+---------+------+-------+------------------+-----------+---------------+\\n| Id | User | Host      | db    | Command | Time | State | Info             | Rows_sent | Rows_examined |\\n+----+------+-----------+-------+---------+------+-------+------------------+-----------+---------------+\\n| 25 | root | localhost | mymgr | Query   |    0 | init  | show processlist |         0 |             0 |\\n+----+------+-----------+-------+---------+------+-------+------------------+-----------+---------------+\\n\\n[root@yejr.run] [mymgr]> begin; select *,sleep(1000) from t1 for update;\\n...  <-- \u8fd9\u4e2aSQL\u4f1a\u8fd0\u884c\u5f88\u957f\u65f6\u95f4\uff0c\u65b9\u4fbf\u6211\u4eec\u89c2\u5bdf\\n```\\n\\n\u65b0\u5f00\u4e00\u4e2a\u7a97\u53e3\uff0c\u67e5\u770b `pfs.threads` \u8868\uff1a\\n```\\n[root@yejr.run] [performance_schema]> SELECT * FROM threads WHERE PROCESSLIST_ID=25\\\\G\\n*************************** 1. row ***************************\\n          THREAD_ID: 65  <-- MySQL\u5185\u90e8\u7ebf\u7a0bID\uff0c\u4e5f\u662fPFS\u7684\u5185\u90e8\u8ba1\u6570\u5668\\n               NAME: thread/sql/one_connection\\n               TYPE: FOREGROUND\\n     PROCESSLIST_ID: 25  <-- MySQL\u8fde\u63a5ID\\n   PROCESSLIST_USER: root\\n   PROCESSLIST_HOST: localhost\\n     PROCESSLIST_DB: mymgr\\nPROCESSLIST_COMMAND: Query\\n   PROCESSLIST_TIME: 246\\n  PROCESSLIST_STATE: User sleep\\n   PROCESSLIST_INFO: select *,sleep(1000) from t1 for update  <-- \u6b63\u5728\u8fd0\u884c\u7684SQL\\n   PARENT_THREAD_ID: NULL\\n               ROLE: NULL\\n       INSTRUMENTED: YES\\n            HISTORY: YES\\n    CONNECTION_TYPE: Socket\\n       THREAD_OS_ID: 58412  <-- \u5bf9\u5e94\u64cd\u4f5c\u7cfb\u7edf\u7684\u7ebf\u7a0bID\\n     RESOURCE_GROUP: USR_default\\n```\\n\\n\u8fd0\u884c `ps -Lef` \u67e5\u770b\u5bf9\u5e94\u7684\u7cfb\u7edf\u7ebf\u7a0b\\n```\\n[root@yejr.run]# ps -Lef | grep 58412  <-- \u4e0a\u9762\u67e5\u8be2pfs.threads\u770b\u5230 THREAD_OS_ID \u5217\u7684\u503c\\nmysql    38801     1 58412  0   40 14:46 ?        00:00:00 /usr/local/GreatSQL-8.0.22/bin/mysqld --defaults-file=/mysql/data06/my.cnf\\n```\\n\\n\u5982\u679c\u8bbe\u7f6e\u4e86 `general_log=1`\uff0c\u90a3\u4e48\u4e5f\u80fd\u770b\u5230 **general_log** \u91cc\u6709\u8fd9\u6837\u7684\u8bb0\u5f55\uff1a\\n```\\n[root@yejr.run]# cat yejr.run.log\\n\\n/usr/local/GreatSQL-8.0.22/bin/mysqld, Version: 8.0.22-13 (Source distribution). started with:\\nTcp port: 6001  Unix socket: mysql.sock\\n#\u51e0\u4e2a\u5217\u5206\u522b\u662f\uff1a\u65f6\u95f4\u3001\u8fde\u63a5ID\u3001\u8bf7\u6c42\u7c7b\u578b\u3001\u8be6\u7ec6\u7684SQL\\nTime                 Id Command    Argument\\n...\\n2021-06-14T14:46:47.474393+08:00\\t   25 Query\\tselect *,sleep(1000) from t1 for update  <-- \u53ef\u4ee5\u770b\u5230\u8fde\u63a5ID\u662f25\\n...\\n```\\n\\n\u518d\u67e5\u8be2 `pfs.events_statements_current` \u8868\uff1a\\n```\\n[root@yejr.run] [performance_schema]> SELECT * FROM events_statements_current WHERE THREAD_ID = 65\\\\G\\n              THREAD_ID: 65\\n               EVENT_ID: 8\\n           END_EVENT_ID: NULL\\n             EVENT_NAME: statement/sql/select\\n                 SOURCE: init_net_server_extension.cc:95\\n            TIMER_START: 82217983305961000\\n              TIMER_END: 82559992238886000\\n             TIMER_WAIT: 342008932925000\\n              LOCK_TIME: 206000000\\n               SQL_TEXT: select *,sleep(1000) from t1 for update\\n                 DIGEST: 4d7f4182dff4abc484010b73024b4afb35075e1b6592d14ce895a2b8764b8f46\\n            DIGEST_TEXT: SELECT * , `sleep` (?) FROM `t1` FOR UPDATE\\n         CURRENT_SCHEMA: mymgr\\n...\\n            SELECT_SCAN: 1\\n...\\n       NESTING_EVENT_ID: 6\\n     NESTING_EVENT_TYPE: TRANSACTION\\n    NESTING_EVENT_LEVEL: 0\\n           STATEMENT_ID: 87  <-- \u67e5\u8be2ID\uff0c\u6bcf\u6b21\u67e5\u8be2\u8be5ID\u503c\u90fd\u4f1a\u589e\u52a0\\n\\n```\\n\\n\u6267\u884c `SHOW ENGINE INNODB STATUS\\\\G` \u67e5\u770b\u4e8b\u52a1\u72b6\u6001\uff1a\\n```\\n...\\n# \u4e8b\u52a1ID=9322\uff0c\u8fd0\u884c\u65f6\u957f=252\u79d2\\n---TRANSACTION 9322, ACTIVE 252 sec\\nmysql tables in use 1, locked 1\\n2 lock struct(s), heap size 1136, 1 row lock(s)\\n# MySQL\u8fde\u63a5ID=25\uff0cOS\u7ebf\u7a0b\u53e5\u67c4 = 140442126739200\uff08\u540e\u9762\u518d\u4ecb\u7ecd\uff09\uff0c\u67e5\u8be2ID=87\uff08\u5bf9\u5e94\u4e0a\u9762\u7684 STATEMENT_ID\uff09\\nMySQL thread id 25, OS thread handle 140442126739200, query id 87 localhost root User sleep\\nselect *,sleep(1000) from t1 for update\\n...\\n```\\n\\n\u518d\u770b\u4e0b `OS thread handle` \u548c\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0bID\u7684\u5bf9\u5e94\u5173\u7cfb\u3002\\n\\n\u9996\u5148\uff0c`OS thread handle 140442126739200` \uff08OS thread handle\u662f\u8fdb\u7a0b\u5185\u90e8\u7528\u4e8e\u8bc6\u522b\u5404\u4e2a\u7ebf\u7a0b\u7684\u5185\u90e8ID\uff09\u8fd9\u91cc\u662f\u4e2a\u5341\u8fdb\u5236\u7684\u6570\u503c\uff0c\u9700\u8981\u5148\u8f6c\u6210\u5341\u516d\u8fdb\u5236\uff08\u6709\u65f6\u5019\u53ef\u80fd\u4f1a\u76f4\u63a5\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\uff0c\u8fd9\u4e2a\u95ee\u9898\u4e5f\u6709\u4eba\u63d0\u51fa\u4e86 [MDEV-17237](https://jira.mariadb.org/browse/MDEV-17237)\uff09\uff1a\\n```\\n[root@yejr.run] [performance_schema]> select lower(conv(140442126739200, 10, 16));\\n+--------------------------------------+\\n| lower(conv(140442126739200, 10, 16)) |\\n+--------------------------------------+\\n| 7fbb3b136700                         |\\n+--------------------------------------+\\n```\\n\\n\u518d\u5229\u7528 `pstack` \u67e5\u8be2\u8be5\u53e5\u67c4\u548c\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0bID\u7684\u5173\u8054\uff1a\\n```\\n[root@yejr.run]# pstack `pidof mysqld` | grep 7fbb3b136700\\nThread 2 (Thread 0x7fbb3b136700 (LWP 58412)):\\n```\\n\u53ef\u4ee5\u770b\u5230 LWP = 58412\uff0c\u5bf9\u5e94\u4e0a\u9762\u7684 `THREAD_OS_ID` \u503c\uff0cLWP\u662fLight-Weight Processes\u7684\u7f29\u5199\uff08\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff09\u3002\u7528 `pidstat` \u4e5f\u80fd\u770b\u5230\u8fd9\u4e2aLWP\uff1a\\n```\\n[root@yejr.run]# pidstat -t -p 38801 | grep 58031\\n03:45:02 PM  1000         -     58031    0.00    0.00    0.00    0.00     2  |__mysqld\\n```\\n\u3010\u7279\u522b\u63d0\u9192\u3011**\u8fd0\u884cpstack\u4f1a\u77ed\u6682\u963b\u585emysqld\u8fdb\u7a0b\uff0c\u6240\u4ee5\u8bf7\u5207\u52ff\u5728\u4e1a\u52a1\u9ad8\u5cf0\u671f\u6267\u884c\uff0c\u9664\u975e\u4e07\u4e0d\u5f97\u5df2**\u3002\\n\\n\u6709\u65f6\u5019\u53ef\u80fd\u4f1a\u770b\u5230\u7c7b\u4f3c\u4e0b\u9762\u7684 innodb status\uff1a\\n```\\nSEMAPHORES\\n----------\\nOS WAIT ARRAY INFO: reservation count 15143\\n--Thread 140585128785664 has waited at buf0flu.cc line 1209 for 237 seconds the semaphore:\\nSX-lock on RW-latch at 0x7fdb1fbe3f80 created in file buf0buf.cc line 1460\\na writer (thread id 140584786024192) has reserved it in mode SX\\nnumber of readers 0, waiters flag 1, lock_word: 10000000\\nLast time read locked in file row0sel.cc line 3758\\nLast time write locked in file /export/home/pb2/build/sb_0-34537258-1560179931.8/mysql-5.7.27/storage/innobase/fsp/fsp0fsp.cc line 167\\n```\\n\u5728\u4e0a\u9762\u8fd9\u6bb5\u4fe1\u606f\u4e2d\uff0c\u7ebf\u7a0b `Thread 140585128785664` \u5728 `buf0flu.cc\u4ee3\u78011209\u884c`\u8fd9\u91cc\u7b49\u5f85\u4e86237\u79d2\uff0c\u60f3\u8981\u8bf7\u6c42 SX-lock \u7684 RW-latch\uff0c\u88ab\u53e6\u4e00\u4e2a\u7ebf\u7a0b `thread id 140584786024192` \u7ed9\u963b\u585e\u4e86\uff0c\u5b83\u6301\u6709\u7684\u662f SX latch\u3002\\n\\n\u8fd9\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u5229\u7528pstack\u53cd\u67e5\u5bf9\u5e94\u7684LWP\uff0c\u518d\u53cd\u67e5\u51faPROCESSLIST_ID\uff0c\u4ee5\u53ca\u6b63\u5728\u6267\u884c\u7684SQL\u3002`pfs.events_statements_current` \u4e2d\u53ea\u80fd\u67e5\u5230\u5f53\u524d\u6267\u884c\u7684SQL\uff0c\u53ef\u4ee5\u901a\u8fc7 `pfs.events_statements_history` \u67e5\u770b\u6700\u8fd1\u6267\u884c\u8fc7\u7684SQL\u3002\\n\\nEnjoy MySQL :)\\n\\n## \u5ef6\u4f38\u9605\u8bfb\\n- 15.17.3 InnoDB Standard Monitor and Lock Monitor Output, https://dev.mysql.com/doc/refman/8.0/en/innodb-standard-monitor.html\\n- 27.12.21.6 The threads Table, https://dev.mysql.com/doc/refman/8.0/en/performance-schema-threads-table.html\\n- 27.12.6.1 The events_statements_current Table, https://dev.mysql.com/doc/refman/8.0/en/performance-schema-events-statements-current-table.html\\n- 27.12.6.2 The events_statements_history Table, https://dev.mysql.com/doc/refman/8.0/en/performance-schema-events-statements-history-table.html"},{"id":"\u6570\u636e\u5e93\u7d22\u5f15\u603b\u7ed3\uff1a\u6a21\u578b\u6570\u7a7a\u8fd0\u6700\u5feb","metadata":{"permalink":"/blog/2021/11/22/songhua","source":"@site/blog/2021-11-22-songhua.md","title":"\u6570\u636e\u5e93\u7d22\u5f15\u603b\u7ed3\uff1a\u6a21\u578b\u6570\u7a7a\u8fd0\u6700\u5feb","description":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u77e5\u6570\u5802SQL \u4f18\u5316\u73ed\u8001\u5e08 \u7f51\u540d\uff1a\u9a91\u9f9f\u7684\u5154\u5b50","date":"2021-11-22T00:00:00.000Z","formattedDate":"November 22, 2021","tags":[{"label":"SQL\u4f18\u5316","permalink":"/blog/tags/sql\u4f18\u5316"},{"label":"\u77e5\u6570\u5802","permalink":"/blog/tags/\u77e5\u6570\u5802"}],"readingTime":9.055,"truncated":false,"authors":[],"prevItem":{"title":"\u6280\u672f\u5206\u4eab | MySQL\u8fdb\u7a0b\u53f7\u3001\u8fde\u63a5ID\u3001\u67e5\u8be2ID\u3001InnoDB\u7ebf\u7a0b\u4e0e\u7cfb\u7edf\u7ebf\u7a0b\u5982\u4f55\u5bf9\u5e94","permalink":"/blog/howto-find-out-os-mysql-innodb-thread"}},"content":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u77e5\u6570\u5802SQL \u4f18\u5316\u73ed\u8001\u5e08 \u7f51\u540d\uff1a\u9a91\u9f9f\u7684\u5154\u5b50\\n\\n\u6211\u4eca\u5929\u5237\u5934\u6761\u7684\u65f6\u5019 \u770b\u5230\u4e86\u4e00\u4f4d\u53eb\u300a\u8001\u733f\u8bf4\u5f00\u53d1\u300b\u603b\u7ed3\u7684\u7d22\u5f15\u4e0d\u80fd\u4f7f\u7528\u53e3\u8bc0\\n\u6a21\u578b\u6570\u7a7a\u8fd0\u6700\u5feb\\n\\n\u6211\u89c9\u5f97\u633a\u597d\uff0c\u4f46\u662f\u56e0\u4e3a\u6ca1\u6709\u5177\u4f53\u7684\u6848\u4f8b\uff0c\u8fd8\u6709\u6ca1\u8bf4\u662f\u54ea\u4e2a\u6570\u636e\u5e93\u8fd9\u4e9b\u9700\u8981\u5b8c\u5584\u7684\u5730\u65b9\uff0c\u6240\u4ee5\u5199\u4e00\u7bc7\u6587\u7ae0\u3002\\n\\n\u6a21\uff1a\u6a21\u7cca\u67e5\u8be2%\u5728\u524d\u9762\u60c5\u51b5\u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15\uff0c\u8fd9\u79cd\u60c5\u51b5\u975e\u5f97\u8bf4\u4e00\u4e2a\u7279\u4f8b\u5c31\u662f\u4e0d\u56de\u8868\u60c5\u51b5\\n\\n```\\nroot@mysql3306.sock>[employees]>desc select dept_no from t_group2 where dept_no like \'%005\';\\n+----+-------------+----------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+\\n| id | select_type | table    | partitions | type  | possible_keys | key         | key_len | ref  | rows | filtered | Extra                    |\\n+----+-------------+----------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+\\n|  1 | SIMPLE      | t_group2 | NULL       | index | NULL          | ix_dept_no2 | 16      | NULL |   10 |    11.11 | Using where; Using index |\\n+----+-------------+----------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+\\n```\\n\\n\u578b\uff1a\u6570\u636e\u7c7b\u578b\u6709\u53d8\u5316\u7684\u65f6\u5019\u4e0d\u80fd\u4f7f\u7528\\n\\n```\\nroot@mysql3306.sock>[employees]>desc test1 ;\\n+-------+-------------+------+-----+---------+-------+\\n| Field | Type        | Null | Key | Default | Extra |\\n+-------+-------------+------+-----+---------+-------+\\n| id    | varchar(10) | YES  | MUL | NULL    |       |\\n| n     | varchar(10) | YES  |     | NULL    |       |\\n+-------+-------------+------+-----+---------+-------+\\n2 rows in set (0.00 sec)\\n```\\n\\n```\\nroot@mysql3306.sock>[employees]>select * from test1 ;\\n+------+------+\\n| id   | n    |\\n+------+------+\\n| 1000 | NULL |\\n| NULL | NULL |\\n+------+------+\\n2 rows in set (0.00 sec)\\n\\nroot@mysql3306.sock>[employees]>show index from test1 ;\\n+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |\\n+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n| test1 |          1 | ix_id    |            1 | id          | A         |           2 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |\\n+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n1 row in set (0.01 sec)\\n\\nroot@mysql3306.sock>[employees]>desc select * from test1 where id=1000;\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n|  1 | SIMPLE      | test1 | NULL       | ALL  | ix_id         | NULL | NULL    | NULL |    2 |    50.00 | Using where |\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n1 row in set, 3 warnings (0.00 sec)\\n\\nroot@mysql3306.sock>[employees]>desc select * from test1 where id=\'1000\';\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n|  1 | SIMPLE      | test1 | NULL       | ref  | ix_id         | ix_id | 43      | const |    1 |   100.00 | NULL  |\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n1 row in set, 1 warning (0.01 sec)\\n```\\n\\n\\n\u6570\uff1a\u7d22\u5f15\u5217\u5957\u7528\u51fd\u6570\u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15\uff0c\u8fd9\u65f6\u5019mysql 5.7\u53ef\u4ee5\u7528\u865a\u62df\u5217\uff0c8.0\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u51fd\u6570\u7d22\u5f15\uff0c5.6\u7684\u65f6\u5019\u53ef\u4ee5\u5229\u7528\u7c7b\u4f3c\u89e3\u65b9\u7a0b\u65b9\u6cd5\u89e3\u5f00\\n\\n```\\nroot@mysql3306.sock>[employees]>desc select * from test1 where id=\'1000\';\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n|  1 | SIMPLE      | test1 | NULL       | ref  | ix_id         | ix_id | 43      | const |    1 |   100.00 | NULL  |\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n1 row in set, 1 warning (0.01 sec)\\n\\nroot@mysql3306.sock>[employees]>desc select * from test1 where concat(id,\'\')=\'1000\';\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n|  1 | SIMPLE      | test1 | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    2 |   100.00 | Using where |\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n1 row in set, 1 warning (0.00 sec)\\nroot@mysql3306.sock>[employees]>create index idx_t1_ke1 on test1((concat(id,\'\')));\\nQuery OK, 0 rows affected (0.03 sec)\\nRecords: 0  Duplicates: 0  Warnings: 0\\n\\nroot@mysql3306.sock>[employees]>desc select * from test1 where concat(id,\'\')=\'1000\';\\n+----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+\\n| id | select_type | table | partitions | type | possible_keys | key        | key_len | ref   | rows | filtered | Extra |\\n+----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+\\n|  1 | SIMPLE      | test1 | NULL       | ref  | idx_t1_ke1    | idx_t1_ke1 | 43      | const |    1 |   100.00 | NULL  |\\n+----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+\\n1 row in set, 1 warning (0.00 sec)\\n```\\n\\n\\n\u7a7a\uff1a\u7d22\u5f15\u5217\u6709\u7a7a\u503c\u4f7f\u7528is null \u5c31\u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15\uff0c\u8fd9\u4e2a\u5728oracle \u662f\u6ca1\u95ee\u9898\u7684\\n       \u4f46\u662f\u5728mysql \u8fd9\u4e2a\u662f\u9519\u7684\\n\\n```\\nroot@mysql3306.sock>[employees]>desc test1 ;\\n+-------+-------------+------+-----+---------+-------+\\n| Field | Type        | Null | Key | Default | Extra |\\n+-------+-------------+------+-----+---------+-------+\\n| id    | varchar(10) | YES  | MUL | NULL    |       |\\n| n     | varchar(10) | YES  |     | NULL    |       |\\n+-------+-------------+------+-----+---------+-------+\\n2 rows in set (0.00 sec)\\n\\nroot@mysql3306.sock>[employees]>select * from test1 ;\\n+------+------+\\n| id   | n    |\\n+------+------+\\n| 1000 | NULL |\\n| NULL | NULL |\\n+------+------+\\n2 rows in set (0.00 sec)\\n\\nroot@mysql3306.sock>[employees]>show index from test1 ;\\n+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |\\n+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n| test1 |          1 | ix_id    |            1 | id          | A         |           2 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |\\n+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n1 row in set (0.01 sec)\\n\\nroot@mysql3306.sock>[employees]>desc select * from test1 where id is null;\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-----------------------+\\n| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra                 |\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-----------------------+\\n|  1 | SIMPLE      | test1 | NULL       | ref  | ix_id         | ix_id | 43      | const |    1 |   100.00 | Using index condition |\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-----------------------+\\n1 row in set, 1 warning (0.00 sec)\\n\\nroot@mysql3306.sock>[employees]>desc select * from test1 where id is not  null;\\n+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+\\n| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                 |\\n+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+\\n|  1 | SIMPLE      | test1 | NULL       | range | ix_id         | ix_id | 43      | NULL |    1 |   100.00 | Using index condition |\\n+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+\\n1 row in set, 1 warning (0.00 sec)\\n```\\n\\n\u8fd0\uff1a\u7d22\u5f15\u5217\u6709\u6570\u5b57\u8fd0\u7b97\u7684\u65f6\u5019\u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15\\n\\n```\\nroot@mysql3306.sock>[employees]>desc select * from test1 where id=\'1000\';\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n|1| SIMPLE      | test1 | NULL       | ref  | ix_id         | ix_id | 43      | const |    1 |100.00| NULL  |\\n+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+\\n1 row in set, 1 warning (0.00 sec)\\n\\nroot@mysql3306.sock>[employees]>desc select * from test1 where id+0=\'1000\';\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n|1| SIMPLE      | test1 | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    2 |100.00| Using where |\\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+\\n1 row in set, 1 warning (0.00 sec)\\n```\\n\\n\u6700\uff1a\u590d\u5408\u7d22\u5f15\uff0c\u6700\u5de6\u8fb9\u539f\u5219\uff0c\u8fd9\u4e2a\u4e5f\u9700\u8981\u5206\u60c5\u51b5\u5206\u7248\u672c\uff0c\u56e0\u4e3a\u6709skip index\u7684\u5b58\u5728\\n\\n```\\nroot@mysql3306.sock>[employees]>show index from dept_emp2 ;\\n+-----------+------------+-------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n| Table     | Non_unique | Key_name    | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |\\n+-----------+------------+-------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n| dept_emp2 |          1 | ix_dept_emp |            1 | dept_no     | A         |           8 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |\\n| dept_emp2 |          1 | ix_dept_emp |            2 | emp_no      | A         |      315555 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |\\n+-----------+------------+-------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+\\n2 rows in set (0.00 sec)\\nroot@mysql3306.sock>[employees]>desc select * from dept_emp2 where emp_no=10001 limit 10 ;\\n+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+\\n| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |\\n+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+\\n|  1 | SIMPLE      | dept_emp2 | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 331008 |    10.00 | Using where |\\n+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+\\n1 row in set, 1 warning (0.00 sec)\\n\\nroot@mysql3306.sock>[employees]>desc select emp_no,dept_no from dept_emp2 where emp_no=10001 limit 10 ;\\n+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+----------------------------------------+\\n| id | select_type | table     | partitions | type  | possible_keys | key         | key_len | ref  | rows  | filtered | Extra                                  |\\n+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+----------------------------------------+\\n|  1 | SIMPLE      | dept_emp2 | NULL       | range | ix_dept_emp   | ix_dept_emp | 20      | NULL | 33100 |   100.00 | Using where; Using index for skip scan |\\n+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+----------------------------------------+\\n1 row in set, 1 warning (0.00 sec)\\n```\\n\\n\u5feb\uff1a\u5982\u679c\u4f18\u5316\u5668\u8ba4\u4e3a\u4f7f\u7528\u5168\u8868\u6bd4\u4f7f\u7528\u7d22\u5f15\u5feb\uff0c\u90a3\u5c31\u4e0d\u4f1a\u4f7f\u7528\u7d22\u5f15\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u57fa\u4e8e\u4f18\u5316\u5668\u6216\u8005\u7edf\u8ba1\u4fe1\u606f\uff0c\u8fd9\u4e2a\u5c31\u662f\u6240\u8c13\u7684\u767e\u5206\u6bd4\uff0c\u8fd9\u91cc\u6700\u91cd\u8981\u7684\u4e00\u70b9\u662f\u4f7f\u7528\u7d22\u5f15\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u56de\u8868\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u968f\u673aIO,\u8fd9\u4e2a\u968f\u7740\u56de\u8868\u7684\u91cf\u7684\u5927\u5c0f\u53d8\u5927\uff0c\u4e00\u822cOLTP\u90fd\u662f\u5728\u8868\u4e0b\u67e5\u8be2\u5c11\u91cf\u6570\u636e\u60c5\u51b5\uff0c\u6240\u4ee5\u8fd8\u662f\u4f7f\u7528\u7d22\u5f15\u7684\u60c5\u51b5\u4f1a\u597d\\n\\n\u5f53\u7136\u4e0a\u9762\u7684\u60c5\u51b5\u4e4b\u5916\uff0c\u8fd8\u6709\u522b\u7684\u60c5\u51b5\uff0c\u5982\u65e5\u671f\u7c7b\u578b\uff0c\u8fd8\u6709\u5b57\u7b26\u4e32\u6bd4\u8f83\u7684\u65f6\u5019\u7b49\u7b49\uff0c\u8fd9\u4e9b\u5728\u8bfe\u5802\u4e2d\u6709\u8be6\u7ec6\u7684\u89e3\u7b54\u3002\\n\u6211\u662f\u77e5\u6570\u5802SQL \u4f18\u5316\u73ed\u8001\u5e08~ ^^\\n\\n\u6700\u65b0\u4e00\u671fSQL\u4f18\u5316\u8bfe\uff0c\u572812\u6708\u4efd\u5f00\u59cb\u3002\\n\\n\u5982\u6709\u5173\u4e8eSQL\u4f18\u5316\u65b9\u9762\u7591\u95ee\u548c\u4e00\u8d77\u4ea4\u6d41\u7684\u8bf7\u52a0 \u5e76\u4e14 @\u5154\u5b50@\u77e5\u6570\u5802SQL\u4f18\u5316\\n\\n\u9ad8\u6027\u80fdMySQL,SQL\u4f18\u5316\u7fa4 \u6709\u53f6\u91d1\u8363\uff0c\u5434\u70b3\u9521 \u4e24\u4f4d\u5927\u795e\u5750\u9547 \uff1a579036588\\n\\n\u6b22\u8fce\u52a0\u5165 \u77e5\u6570\u5802\u5927\u5bb6\u5ead\u3002\\n\\n\u6211\u7684\u5fae\u4fe1\u516c\u4f17\u53f7\uff1aSQL\u5f00\u53d1\u4e0e\u4f18\u5316(sqlturning)"}]}')}}]);