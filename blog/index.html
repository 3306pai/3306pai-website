<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="3306π RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="3306π Atom Feed"><title data-react-helmet="true">Blog | 3306π</title><meta data-react-helmet="true" property="og:title" content="Blog | 3306π"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://3306pai.cn/blog"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://3306pai.cn/blog"><link data-react-helmet="true" rel="alternate" href="https://3306pai.cn/blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://3306pai.cn/blog" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4628d916.css">
<link rel="preload" href="/assets/js/runtime~main.8cb3a667.js" as="script">
<link rel="preload" href="/assets/js/main.e1a1e7c6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_fBz2"><div data-pc="true" class="navbar__inner_pc"><div class="navbar__inner"><a style="width:2.604167vw;height:2.604167vw" href="/"><img src="data:image/png;base64,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"></a><div class="navbar__items_wrap"><a class="navbar__item navbar__link pc-nav-item" href="/">首页</a><a class="navbar__item navbar__link pc-nav-item" href="/meeting/3306pai-sz-2021">会议</a><a class="navbar__item navbar__link pc-nav-item" href="/sponser">赞助商</a><a class="navbar__item navbar__link pc-nav-item" href="/blog/databend-architecture">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link pc-nav-item">资源</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/mentors/liukaiyang-action">嘉宾</a></li><li><a href="https://github.com/3306pai/3306Pai-presentations" target="_blank" rel="noopener noreferrer" class="dropdown__link">往期PPT</a></li></ul></div><a class="navbar__item navbar__link pc-nav-item" href="/contact-us">联系我们</a></div></div></div><div data-phone="true" class="navbar__inner-phone-wrap"><div class="navbar__inner"><a style="width:8vw;height:8vw" href="/"><img src="data:image/png;base64,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"></a><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg t="1635920265080" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2474" style="width:6.4vw"><path d="M44.4 245.9h935.2c24.4 0 44.4-20 44.4-44.4s-19.8-44.4-44.4-44.4H44.4C20 157.1 0 177.1 0 201.5s20 44.4 44.4 44.4z m935.2 221.8H44.4C20 467.7 0 487.7 0 512.1s20 44.4 44.4 44.4h935.2c24.4 0 44.4-20 44.4-44.4s-20-44.4-44.4-44.4z m0 310.4H44.4C20 778.1 0 797.8 0 822.5s20 44.4 44.4 44.4h935.2c24.4 0 44.4-19.8 44.4-44.4s-20-44.4-44.4-44.4z" p-id="2475" fill="#76AFF7"></path></svg></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><img src="data:image/png;base64,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" style="width:8vw;height:8vw"></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">首页</a></li><li class="menu__list-item"><a class="menu__link" href="/meeting/3306pai-sz-2021">会议</a></li><li class="menu__list-item"><a class="menu__link" href="/sponser">赞助商</a></li><li class="menu__list-item"><a class="menu__link" href="/blog/databend-architecture">Blog</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">资源</a></li><li class="menu__list-item"><a class="menu__link" href="/contact-us">联系我们</a></li></ul></div></div></div></nav><div class="gl-main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/databend-architecture">Databend architecture</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/howto-find-out-os-mysql-innodb-thread">技术分享 | MySQL进程号、连接ID、查询ID、InnoDB线程与系统线程如何对应</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2021/11/22/songhua">数据库索引总结：模型数空运最快</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/databend-architecture">Databend architecture</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-11-22T01:35:01.011Z" itemprop="datePublished">November 22, 2021</time> · <!-- -->7 min read</div></header><div class="markdown" itemprop="articleBody"><p>Databend 是一个开源的、完全面向云架构的新式数仓，它提供快速的弹性扩展能力，并结合云的弹性、简单性和低成本，使 Data Cloud 构建变得更加容易。
Databend 把数据存储在像 AWS S3 ，Azure Blob 这些云上的存储系统，可以使不同的计算节点挂载同一份数据，从而做到较高的弹性，实现对资源的精细化控制。
Databend 在设计上专注以下能力：</p><ul><li>弹性 在 Databend 中，存储和计算资源可以按需、按量弹性扩展。</li><li>安全 Databend 中数据文件和网络传输都是端到端加密，并在 SQL 级别提供基于角色的权限控制。</li><li>易用 Databend 兼容 ANSI SQL，并可以使用 MySQL 和 ClickHouse 客户端接入，几乎无学习成本。</li><li>成本 Databend 处理查询非常高效，用户只需要为使用的资源付费。</li></ul><p><img src="https://datafuse-1255499614.cos.ap-beijing.myqcloud.com/architecture_v1.png"></p><p>上图是 Databend 的整体架构图，整个系统主要由三大部分组成：Meta service layer、Compute Layer 和 Storage Layer。</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="1meta-service-layer">1、Meta Service Layer<a aria-hidden="true" class="hash-link" href="#1meta-service-layer" title="Direct link to heading">​</a></h2><ul><li>Meta Service 是一个多租户、高可用的分布式 key-value 存储服务，具备事务能力，主要用于存储：</li><li>Metadata : 表的元信息、索引信息、集群信息、事务信息等。</li><li>Administration：用户系统、用户权限等信息。</li><li>Security ：用户登录认证、数据加密等。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="2compute-layer">2、Compute Layer<a aria-hidden="true" class="hash-link" href="#2compute-layer" title="Direct link to heading">​</a></h2><p>计算层由多个集群（cluster）组成，不同集群可以承担不同的工作负载，每个集群又有多个计算节点（node）组成，你可以轻松的添加、删除节点或集群，做到资源的按需、按量管理。
计算节点是计算层的最小构成单元，其中每个计算节点包含以下几个组件：
执行计划 （Planner）
根据用户输入的 SQL 生成执行计划，它只是个逻辑表达，并不能真正的执行，而是用于指导整个计算流水线（Pipeline）的编排与生成。
比如语句</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT number + 1 FROM numbers_mt(10) WHERE number &gt; 8 LIMIT 2 </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>执行计划：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">databend :) EXPLAIN SELECT number + 1 FROM numbers_mt(10) WHERE number &gt; 8 LIMIT 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─explain────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Limit: 2                                                                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   Projection: (number + 1):UInt64                                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     Expression: (number + 1):UInt64 (Before Projection)                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       Filter: (number &gt; 8)                                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         ReadDataSource: scan partitions: [1], scan schema: [number:UInt64], statistics: [read_rows: 10, read_bytes: 80] │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>这个执行计划自下而上分别是 ：</p><ul><li><p>ReadDataSource：表示从哪些文件里读取数据</p></li><li><p>Filter: 表示要做 (number &gt; 8) 表达式过滤</p></li><li><p>Expression: 表示要做 (number + 1) 表达式运算</p></li><li><p>Projection: 表示查询列是哪些</p></li><li><p>Limit: 表示取前 2 条数据</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="优化器-optimizer">优化器 （Optimizer）<a aria-hidden="true" class="hash-link" href="#优化器-optimizer" title="Direct link to heading">​</a></h3><p>对执行计划做一些基于规则的优化（A Rule Based Optimizer）, 比如做一些谓词下推或是去掉一些不必要的列等，以使整个执行计划更优。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="处理器-processors">处理器 （Processors）<a aria-hidden="true" class="hash-link" href="#处理器-processors" title="Direct link to heading">​</a></h3><p>处理器（Processor）是执行计算逻辑的核心组件。根据执行计划，处理器们被编排成一个流水线（Pipeline），用于执行计算任务。
整个 Pipeline 是一个有向无环图，每个点是一个处理器，每条边由处理器的 InPort 和 OutPort 相连构成，数据到达不同的处理器进行计算后，通过边流向下一个处理器，多个处理器可以并行计算，在集群模式下还可以跨节点分布式执行，这是 Datafuse 高性能的一个重要设计。</p><p>例如，我们可以通过 EXPLAIN PIPELINE 来查看：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">databend :) EXPLAIN PIPELINE SELECT number + 1 FROM numbers_mt(10000) WHERE number &gt; 8 LIMIT 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─explain───────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ LimitTransform × 1 processor                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   Merge (ProjectionTransform × 16 processors) to (LimitTransform × 1)     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ProjectionTransform × 16 processors                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ExpressionTransform × 16 processors                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         FilterTransform × 16 processors                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           SourceTransform × 16 processors                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└───────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>同样，理解这个 Pipeline 我们自下而上来看：</p><ul><li>SourceTransform：读取数据文件，16 个物理 CPU 并行处理</li><li>ilterTransform：对数据进行 (number &gt;  8) 表达式过滤，16 个物理 CPU 并行处理 </li><li>pressionTransform：对数据进行 (number + 1) 表达式执行，16 个物理 CPU 并行处理 </li><li>ojectionTransform：对数据处理生成最终列 </li><li>LimitTransform：对数据进行 Limit 2 处理，Pipeline 进行折叠，由一个物理 CPU 来执行 </li><li>Databend 通过 Pipeline 并行模型，并结合向量计算最大限度的去压榨 CPU 资源，以加速计算。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="缓存--cache-">缓存 ( Cache )<a aria-hidden="true" class="hash-link" href="#缓存--cache-" title="Direct link to heading">​</a></h3><p>计算节点使用本地 SSD 缓存数据和索引，以提高数据亲和性来加速计算。
缓存的预热方式有：
LOAD_ON_DEMAND - 按需加载索引或数据块（默认）。
LOAD_INDEX - 只加载索引。
LOAD_ALL - 加载全部的数据和索引，对于较小的表可以采取这种模式。</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="3-storage-layer">3. Storage Layer<a aria-hidden="true" class="hash-link" href="#3-storage-layer" title="Direct link to heading">​</a></h2><p>Databend 使用 Parquet 列式存储格式来储存数据，为了加快查找（Partition Pruning），Databend  为每个 Parquet 提供了自己的索引（根据 Primary Key 生成）：
min_max.idx Parquet 文件 minimum 和 maximum 值
sparse.idx 以 N 条记录为颗粒度的稀疏索引
通过这些索引， 我们可以减少数据的交互，并使计算量大大减少。
假设有两个Parquet 文件：f1, f2，f1 的 min_max.idx: <!-- -->[3, 5]<!-- --> ；f2 的 min_max.idx: <!-- -->[4, 6]<!-- --> 。如果查询条件为：where x &lt; 4 ， 我们只需要 f1 文件就可以，再根据 sparse.idx 索引定位到 f1 文件中的某个数据页。</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="项目地址">项目地址<a aria-hidden="true" class="hash-link" href="#项目地址" title="Direct link to heading">​</a></h2><p>代码地址：
<a href="https://github.com/datafuselabs/databend" target="_blank" rel="noopener noreferrer">https://github.com/datafuselabs/databend</a></p><p>项目官网：
<a href="https://datafuse.rs" target="_blank" rel="noopener noreferrer">https://datafuse.rs</a></p><p>想了解我们更多可以关注公众号： Databend .</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/howto-find-out-os-mysql-innodb-thread">技术分享 | MySQL进程号、连接ID、查询ID、InnoDB线程与系统线程如何对应</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-11-22T01:35:01.011Z" itemprop="datePublished">November 22, 2021</time> · <!-- -->8 min read</div></header><div class="markdown" itemprop="articleBody"><hr><p>title: 技术分享 | MySQL进程号、连接ID、查询ID、InnoDB线程与系统线程如何对应
author: 叶金荣</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="keywords-linux-mysql-innodb">keywords: <!-- -->[Linux, MySQL, InnoDB]<a aria-hidden="true" class="hash-link" href="#keywords-linux-mysql-innodb" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="导读">导读<a aria-hidden="true" class="hash-link" href="#导读" title="Direct link to heading">​</a></h2><blockquote><p>一文快速掌握 MySQL进程号、连接ID、查询ID、InnoDB线程与系统线程的对应关系。</p></blockquote><p>有时候，怀疑某个MySQL内存查询导致CPU或磁盘I/O消耗特别高，但又不确定具体是哪个SQL引起的。</p><p>或者当InnoDB引擎内部有semaphore wait时，想知道具体是哪个线程/查询引起的。多说一下，当有semaphore wait事件超过600秒的话，InnoDB会发出crash信号：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">InnoDB: ###### Diagnostic info printed to the standard error stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-12-13T09:41:33.810011Z 0 [ERROR] [FATAL] InnoDB: Semaphore wait has lasted &gt; 600 seconds. We intentionally crash the server because it appears to be hung.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-12-13 10:41:33 0x7f3d92a4e700 InnoDB: Assertion failure in thread 139902430013184 in file ut0ut.cc line 917</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InnoDB: We intentionally generate a memory trap.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InnoDB: Submit a detailed bug report to http://bugs.mysql.com.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InnoDB: If you get repeated assertion failures or crashes, even</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InnoDB: immediately after the mysqld startup, there may be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InnoDB: corruption in the InnoDB tablespace. Please refer to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InnoDB: http://dev.mysql.com/doc/refman/8.0/en/forcing-innodb-recovery.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InnoDB: about forcing recovery.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:41:33 UTC - mysqld got signal 6 ;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>因此也要监控InnoDB的semaphore wait状态，一旦超过阈值，就要尽快报警并分析出问题原因，及时杀掉或停止引起等待的查询请求。</p><p>不过本文想讨论的是，MySQL的进程ID、内部查询ID、内部线程ID，和操作系统层的进程ID、线程如何对应起来。</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="1操作系统进程id">1、操作系统进程ID<a aria-hidden="true" class="hash-link" href="#1操作系统进程id" title="Direct link to heading">​</a></h2><p>MySQL是一个单进程多线程的服务程序，用 <code>ps -ef|grep mysqld</code> 就能看到其系统进程ID了。另外，当 <code>my.cnf</code> 配置文件中增加一行 <code>innodb_status_file = 1</code> 时，也会生成带有系统进程ID的innodb status 文件</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run]# ps -ef | grep mysqld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql    38801     1  0 Jun13 ?        00:03:30 /usr/local/GreatSQL-8.0.22/bin/mysqld --defaults-file=/mysql/data06/my.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run]# ls -la innodb_status.38801</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r----- 1 mysql mysql 4906 Jun 14 14:26 innodb_status.38801</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>文件 <code>innodb_status.pid</code> 的作用是每隔15秒左右输出innodb引擎各种状态信息，和执行 <code>SHOW ENGINE INNODB STATUS</code> 的作用相同。 二者的区别在于，前者（文件输出方式）的输出内容长度不受限制，而后者（命令行输出）则最多只显示1MB内容，更多的会被截断。所以务必设置 <code>innodb_status_file = 1</code> 选项。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">Standard Monitor output is limited to 1MB when produced using the SHOW ENGINE INNODB STATUS statement. This limit does not apply to output written to server standard error output (stderr).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="2系统线程和mysql连接id查询id等的关系">2、系统线程和MySQL连接ID、查询ID等的关系<a aria-hidden="true" class="hash-link" href="#2系统线程和mysql连接id查询id等的关系" title="Direct link to heading">​</a></h2><p>从MySQL 5.7开始，<code>performance_schema.threads</code> 表增加 <code>THREAD_OS_ID</code> 列，用于记录MySQL内部线程对应的系统线程ID。</p><p>创建一个新连接，并执行下面的SQL：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run]# mysql -S./mysql.sock -uroot -p mymgr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查到MySQL的连接ID是25（PROCESSLIST_ID = 25）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run] [none]&gt; show processlist;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+------+-----------+-------+---------+------+-------+------------------+-----------+---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Id | User | Host      | db    | Command | Time | State | Info             | Rows_sent | Rows_examined |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+------+-----------+-------+---------+------+-------+------------------+-----------+---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 25 | root | localhost | mymgr | Query   |    0 | init  | show processlist |         0 |             0 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+------+-----------+-------+---------+------+-------+------------------+-----------+---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run] [mymgr]&gt; begin; select *,sleep(1000) from t1 for update;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...  &lt;-- 这个SQL会运行很长时间，方便我们观察</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>新开一个窗口，查看 <code>pfs.threads</code> 表：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run] [performance_schema]&gt; SELECT * FROM threads WHERE PROCESSLIST_ID=25\G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          THREAD_ID: 65  &lt;-- MySQL内部线程ID，也是PFS的内部计数器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               NAME: thread/sql/one_connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               TYPE: FOREGROUND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     PROCESSLIST_ID: 25  &lt;-- MySQL连接ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PROCESSLIST_USER: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PROCESSLIST_HOST: localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     PROCESSLIST_DB: mymgr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSLIST_COMMAND: Query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PROCESSLIST_TIME: 246</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PROCESSLIST_STATE: User sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PROCESSLIST_INFO: select *,sleep(1000) from t1 for update  &lt;-- 正在运行的SQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PARENT_THREAD_ID: NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               ROLE: NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       INSTRUMENTED: YES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HISTORY: YES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CONNECTION_TYPE: Socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       THREAD_OS_ID: 58412  &lt;-- 对应操作系统的线程ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     RESOURCE_GROUP: USR_default</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>运行 <code>ps -Lef</code> 查看对应的系统线程</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run]# ps -Lef | grep 58412  &lt;-- 上面查询pfs.threads看到 THREAD_OS_ID 列的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql    38801     1 58412  0   40 14:46 ?        00:00:00 /usr/local/GreatSQL-8.0.22/bin/mysqld --defaults-file=/mysql/data06/my.cnf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>如果设置了 <code>general_log=1</code>，那么也能看到 <strong>general_log</strong> 里有这样的记录：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run]# cat yejr.run.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/GreatSQL-8.0.22/bin/mysqld, Version: 8.0.22-13 (Source distribution). started with:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tcp port: 6001  Unix socket: mysql.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#几个列分别是：时间、连接ID、请求类型、详细的SQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time                 Id Command    Argument</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-06-14T14:46:47.474393+08:00       25 Query select *,sleep(1000) from t1 for update  &lt;-- 可以看到连接ID是25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>再查询 <code>pfs.events_statements_current</code> 表：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run] [performance_schema]&gt; SELECT * FROM events_statements_current WHERE THREAD_ID = 65\G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              THREAD_ID: 65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               EVENT_ID: 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           END_EVENT_ID: NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             EVENT_NAME: statement/sql/select</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 SOURCE: init_net_server_extension.cc:95</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TIMER_START: 82217983305961000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              TIMER_END: 82559992238886000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             TIMER_WAIT: 342008932925000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              LOCK_TIME: 206000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               SQL_TEXT: select *,sleep(1000) from t1 for update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 DIGEST: 4d7f4182dff4abc484010b73024b4afb35075e1b6592d14ce895a2b8764b8f46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DIGEST_TEXT: SELECT * , `sleep` (?) FROM `t1` FOR UPDATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         CURRENT_SCHEMA: mymgr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SELECT_SCAN: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       NESTING_EVENT_ID: 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     NESTING_EVENT_TYPE: TRANSACTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NESTING_EVENT_LEVEL: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           STATEMENT_ID: 87  &lt;-- 查询ID，每次查询该ID值都会增加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>执行 <code>SHOW ENGINE INNODB STATUS\G</code> 查看事务状态：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 事务ID=9322，运行时长=252秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---TRANSACTION 9322, ACTIVE 252 sec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql tables in use 1, locked 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 lock struct(s), heap size 1136, 1 row lock(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MySQL连接ID=25，OS线程句柄 = 140442126739200（后面再介绍），查询ID=87（对应上面的 STATEMENT_ID）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MySQL thread id 25, OS thread handle 140442126739200, query id 87 localhost root User sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select *,sleep(1000) from t1 for update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>再看下 <code>OS thread handle</code> 和操作系统线程ID的对应关系。</p><p>首先，<code>OS thread handle 140442126739200</code> （OS thread handle是进程内部用于识别各个线程的内部ID）这里是个十进制的数值，需要先转成十六进制（有时候可能会直接用十六进制表示，这个问题也有人提出了 <a href="https://jira.mariadb.org/browse/MDEV-17237" target="_blank" rel="noopener noreferrer">MDEV-17237</a>）：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run] [performance_schema]&gt; select lower(conv(140442126739200, 10, 16));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| lower(conv(140442126739200, 10, 16)) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 7fbb3b136700                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------------------+</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>再利用 <code>pstack</code> 查询该句柄和操作系统线程ID的关联：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run]# pstack `pidof mysqld` | grep 7fbb3b136700</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Thread 2 (Thread 0x7fbb3b136700 (LWP 58412)):</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>可以看到 LWP = 58412，对应上面的 <code>THREAD_OS_ID</code> 值，LWP是Light-Weight Processes的缩写（轻量级进程）。用 <code>pidstat</code> 也能看到这个LWP：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[root@yejr.run]# pidstat -t -p 38801 | grep 58031</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">03:45:02 PM  1000         -     58031    0.00    0.00    0.00    0.00     2  |__mysqld</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>【特别提醒】<strong>运行pstack会短暂阻塞mysqld进程，所以请切勿在业务高峰期执行，除非万不得已</strong>。</p><p>有时候可能会看到类似下面的 innodb status：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">SEMAPHORES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OS WAIT ARRAY INFO: reservation count 15143</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--Thread 140585128785664 has waited at buf0flu.cc line 1209 for 237 seconds the semaphore:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SX-lock on RW-latch at 0x7fdb1fbe3f80 created in file buf0buf.cc line 1460</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a writer (thread id 140584786024192) has reserved it in mode SX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">number of readers 0, waiters flag 1, lock_word: 10000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last time read locked in file row0sel.cc line 3758</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last time write locked in file /export/home/pb2/build/sb_0-34537258-1560179931.8/mysql-5.7.27/storage/innobase/fsp/fsp0fsp.cc line 167</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在上面这段信息中，线程 <code>Thread 140585128785664</code> 在 <code>buf0flu.cc代码1209行</code>这里等待了237秒，想要请求 SX-lock 的 RW-latch，被另一个线程 <code>thread id 140584786024192</code> 给阻塞了，它持有的是 SX latch。</p><p>这时候，就可以利用pstack反查对应的LWP，再反查出PROCESSLIST_ID，以及正在执行的SQL。<code>pfs.events_statements_current</code> 中只能查到当前执行的SQL，可以通过 <code>pfs.events_statements_history</code> 查看最近执行过的SQL。</p><p>Enjoy MySQL :)</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="延伸阅读">延伸阅读<a aria-hidden="true" class="hash-link" href="#延伸阅读" title="Direct link to heading">​</a></h2><ul><li>15.17.3 InnoDB Standard Monitor and Lock Monitor Output, <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-standard-monitor.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/innodb-standard-monitor.html</a></li><li>27.12.21.6 The threads Table, <a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-threads-table.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/performance-schema-threads-table.html</a></li><li>27.12.6.1 The events_statements_current Table, <a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-events-statements-current-table.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/performance-schema-events-statements-current-table.html</a></li><li>27.12.6.2 The events_statements_history Table, <a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-events-statements-history-table.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/performance-schema-events-statements-history-table.html</a></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/blog/2021/11/22/songhua">数据库索引总结：模型数空运最快</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-11-22T00:00:00.000Z" itemprop="datePublished">November 22, 2021</time> · <!-- -->10 min read</div></header><div class="markdown" itemprop="articleBody"><p>大家好，我是知数堂SQL 优化班老师 网名：骑龟的兔子</p><p>我今天刷头条的时候 看到了一位叫《老猿说开发》总结的索引不能使用口诀
模型数空运最快</p><p>我觉得挺好，但是因为没有具体的案例，还有没说是哪个数据库这些需要完善的地方，所以写一篇文章。</p><p>模：模糊查询%在前面情况不能使用索引，这种情况非得说一个特例就是不回表情况</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select dept_no from t_group2 where dept_no like &#x27;%005&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+----------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table    | partitions | type  | possible_keys | key         | key_len | ref  | rows | filtered | Extra                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+----------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | t_group2 | NULL       | index | NULL          | ix_dept_no2 | 16      | NULL |   10 |    11.11 | Using where; Using index |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+----------+------------+-------+---------------+-------------+---------+------+------+----------+--------------------------+</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>型：数据类型有变化的时候不能使用</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc test1 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+-------------+------+-----+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Field | Type        | Null | Key | Default | Extra |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+-------------+------+-----+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id    | varchar(10) | YES  | MUL | NULL    |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| n     | varchar(10) | YES  |     | NULL    |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+-------------+------+-----+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 rows in set (0.00 sec)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;select * from test1 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id   | n    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1000 | NULL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| NULL | NULL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 rows in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;show index from test1 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test1 |          1 | ix_id    |            1 | id          | A         |           2 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.01 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where id=1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | test1 | NULL       | ALL  | ix_id         | NULL | NULL    | NULL |    2 |    50.00 | Using where |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 3 warnings (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where id=&#x27;1000&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | test1 | NULL       | ref  | ix_id         | ix_id | 43      | const |    1 |   100.00 | NULL  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.01 sec)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>数：索引列套用函数不能使用索引，这时候mysql 5.7可以用虚拟列，8.0可以直接使用函数索引，5.6的时候可以利用类似解方程方法解开</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where id=&#x27;1000&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | test1 | NULL       | ref  | ix_id         | ix_id | 43      | const |    1 |   100.00 | NULL  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.01 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where concat(id,&#x27;&#x27;)=&#x27;1000&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | test1 | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    2 |   100.00 | Using where |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;create index idx_t1_ke1 on test1((concat(id,&#x27;&#x27;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.03 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: 0  Duplicates: 0  Warnings: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where concat(id,&#x27;&#x27;)=&#x27;1000&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type | possible_keys | key        | key_len | ref   | rows | filtered | Extra |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | test1 | NULL       | ref  | idx_t1_ke1    | idx_t1_ke1 | 43      | const |    1 |   100.00 | NULL  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.00 sec)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>空：索引列有空值使用is null 就不能使用索引，这个在oracle 是没问题的
但是在mysql 这个是错的</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc test1 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+-------------+------+-----+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Field | Type        | Null | Key | Default | Extra |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+-------------+------+-----+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id    | varchar(10) | YES  | MUL | NULL    |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| n     | varchar(10) | YES  |     | NULL    |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+-------------+------+-----+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 rows in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;select * from test1 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id   | n    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1000 | NULL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| NULL | NULL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 rows in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;show index from test1 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test1 |          1 | ix_id    |            1 | id          | A         |           2 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.01 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where id is null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | test1 | NULL       | ref  | ix_id         | ix_id | 43      | const |    1 |   100.00 | Using index condition |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where id is not  null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | test1 | NULL       | range | ix_id         | ix_id | 43      | NULL |    1 |   100.00 | Using index condition |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.00 sec)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>运：索引列有数字运算的时候不能使用索引</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where id=&#x27;1000&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|1| SIMPLE      | test1 | NULL       | ref  | ix_id         | ix_id | 43      | const |    1 |100.00| NULL  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from test1 where id+0=&#x27;1000&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|1| SIMPLE      | test1 | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    2 |100.00| Using where |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.00 sec)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>最：复合索引，最左边原则，这个也需要分情况分版本，因为有skip index的存在</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;show index from dept_emp2 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+-------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Table     | Non_unique | Key_name    | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+-------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| dept_emp2 |          1 | ix_dept_emp |            1 | dept_no     | A         |           8 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| dept_emp2 |          1 | ix_dept_emp |            2 | emp_no      | A         |      315555 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+-------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 rows in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select * from dept_emp2 where emp_no=10001 limit 10 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | dept_emp2 | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 331008 |    10.00 | Using where |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mysql3306.sock&gt;[employees]&gt;desc select emp_no,dept_no from dept_emp2 where emp_no=10001 limit 10 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+----------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | select_type | table     | partitions | type  | possible_keys | key         | key_len | ref  | rows  | filtered | Extra                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+----------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | SIMPLE      | dept_emp2 | NULL       | range | ix_dept_emp   | ix_dept_emp | 20      | NULL | 33100 |   100.00 | Using where; Using index for skip scan |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+----------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set, 1 warning (0.00 sec)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>快：如果优化器认为使用全表比使用索引快，那就不会使用索引，说白了就是基于优化器或者统计信息，这个就是所谓的百分比，这里最重要的一点是使用索引一般情况下是回表，也就是发生随机IO,这个随着回表的量的大小变大，一般OLTP都是在表下查询少量数据情况，所以还是使用索引的情况会好</p><p>当然上面的情况之外，还有别的情况，如日期类型，还有字符串比较的时候等等，这些在课堂中有详细的解答。
我是知数堂SQL 优化班老师~ ^^</p><p>最新一期SQL优化课，在12月份开始。</p><p>如有关于SQL优化方面疑问和一起交流的请加 并且 @兔子@知数堂SQL优化</p><p>高性能MySQL,SQL优化群 有叶金荣，吴炳锡 两位大神坐镇 ：579036588</p><p>欢迎加入 知数堂大家庭。</p><p>我的微信公众号：SQL开发与优化(sqlturning)</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/sql优化">SQL优化</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/知数堂">知数堂</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><div class="footer_TasJ"><div class="footerWraper_DVUg"><div><div class="footerTitle_97MM">资源</div><div class="item_mh6s"><a href="https://github.com/3306pai/3306Pai-presentations" target="_blank" rel="noopener noreferrer">往期PPT</a></div><div class="item_mh6s"><a href="/mentors/liukaiyang-action">嘉宾</a></div></div><div><div class="footerTitle_97MM">联系我们</div><div class="item_mh6s"><a href="/contact-us">Contact us</a></div></div><div><div class="footerTitle_97MM">关注我们</div><div class="item_mh6s itemIcon_88qO"><img class="followUs_b6Mg" src="data:image/png;base64,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"></div></div></div><div class="coppyright_mCtY">Copyright © 2021  3306π. All Rights Reserved.</div></div></div>
<script src="/assets/js/runtime~main.8cb3a667.js"></script>
<script src="/assets/js/main.e1a1e7c6.js"></script>
</body>
</html>